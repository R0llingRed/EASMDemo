# 互联网资产暴露面检测系统（EASM）设计方案（v2）

> **版本**：v2.0  
> **日期**：2026-01-29  
> **文档类型**：系统设计方案（优化版）

---

## 目录

- [一、审计结论与优化摘要](#一审计结论与优化摘要)
- [二、系统定位与范围](#二系统定位与范围)
- [三、架构与关键流程](#三架构与关键流程)
- [四、核心模块设计（优化版）](#四核心模块设计优化版)
- [五、数据模型与数据流](#五数据模型与数据流)
- [六、扫描安全与合规控制](#六扫描安全与合规控制)
- [七、可观测性与质量控制](#七可观测性与质量控制)
- [八、技术选型与部署建议](#八技术选型与部署建议)
- [九、迭代路线图（调整）](#九迭代路线图调整)

---

## 一、审计结论与优化摘要

### 1.1 现有设计合理性评估

- **总体合理**：覆盖资产发现、扫描、漏洞管理、数据融合、告警等核心能力，流程完整。
- **可落地**：工具链与技术栈可用性强，适合作为MVP到生产的演进基础。
- **不足点**：对“资产身份、变化检测、结果可信度、任务编排粒度、风控与合规”的描述不足，数据模型与流程存在细节不一致。

### 1.2 主要优化方向

1. **资产身份统一**：引入“资产实体ID + 指纹快照”，解决域名/IP/端口/URL多源合并冲突。
2. **结果质量控制**：增加“可信度评分、误报标记、验证流水线”。
3. **工作流编排升级**：从“阶段式流水线”升级为“事件驱动 + DAG编排”。
4. **扫描合规与风险控制**：增加授权范围、速率配额、黑白名单、变更审批。
5. **数据生命周期治理**：冷热数据分层、留存策略、归档与删除机制。
6. **多租户与权限模型补足**：项目、团队、资产责任人、字段级权限。
7. **可观测性与SLA**：扫描任务、Agent、工具运行状态全量可观测。

---

## 二、系统定位与范围

### 2.1 系统定位

面向甲方安全团队的外部攻击面管理平台，持续发现、识别、评估和跟踪互联网暴露资产及其风险。

### 2.2 范围边界

- **覆盖**：公网资产、暴露接口、证书与域名、Web应用、API与JS资产。
- **不覆盖**：内部资产（除明确授权）、红队攻击模拟、生产数据渗透。

### 2.3 目标与指标

| 目标 | 关键指标 |
| --- | --- |
| 资产发现 | 新资产发现率、去重后资产量、误报率 |
| 风险识别 | 漏洞准确率、验证通过率、严重漏洞覆盖率 |
| 持续监控 | 新增资产发现延迟、变更检测延迟 |
| 系统稳定 | 任务成功率、Agent可用性、扫描吞吐 |

---

## 三、架构与关键流程

### 3.1 逻辑架构（升级）

- **控制面**：项目/资产/策略/权限管理，扫描治理与审计。
- **数据面**：任务执行、数据采集、结果验证、合并入库。
- **分析面**：资产画像、风险评分、趋势分析、报告输出。

### 3.2 事件驱动 + DAG编排

- **事件驱动**：新增资产、资产变更、扫描完成等事件触发后续任务。
- **DAG编排**：将“子域名 -> 解析 -> 端口 -> Web -> JS -> 漏洞”作为可配置DAG。

### 3.3 关键数据流

1. 输入资产（域名/IP/已有资产）
2. 生成资产实体（统一ID）
3. 根据策略生成任务图（DAG）
4. 任务执行与结果回传
5. 结果校验与可信度评分
6. 结果归一化与入库
7. 通知、报告与运营闭环

---

## 四、核心模块设计（优化版）

### 4.1 资产治理模块

- 资产实体：域名/子域名/IP/端口/URL、证书、服务组件
- 资产身份：统一ID + 来源 + 指纹快照
- 资产变更：状态机（新增/活跃/消失/异常）

### 4.2 任务编排与策略中心

- 扫描策略：频率、速率、范围、工具链组合
- DAG模板：可配置的任务依赖图
- 调度策略：优先级、队列隔离、配额

### 4.3 采集执行与工具编排

- 多Agent调度，工具执行标准化（输入输出约定）
- 支持“执行级健康检查 + 故障重试”
- 结果校验（状态码二次确认、漏洞复现校验）

### 4.4 数据融合与可信度

- 去重策略：指纹、主键、内容哈希
- 可信度评分：多源交叉、响应特征、历史命中
- 结果标记：误报、已修复、需复核

### 4.5 风险评估与告警

- 资产风险评分：暴露度 + 历史漏洞 + 业务权重
- 漏洞生命周期：发现 → 验证 → 修复 → 复测
- 告警策略：阈值 + 事件驱动 + 多渠道

---

## 五、数据模型与数据流

### 5.1 资产实体模型（建议）

- **AssetEntity**（统一资产实体）
  - id、type（domain/ip/url/service）
  - fingerprint_hash、first_seen、last_seen
  - owner、business_unit、importance

- **AssetRelation**（资产关系）
  - source_id、target_id、relation_type（resolves_to/hosts/serves）

- **Observation**（扫描观测）
  - source、raw_data、confidence、observed_at

- **Finding**（漏洞/风险）
  - target_entity_id、type、severity、evidence、status

### 5.2 数据生命周期

- **热数据**：近90天扫描结果
- **温数据**：历史变更轨迹
- **冷数据**：归档报告与历史证据

---

## 六、扫描安全与合规控制

- **授权范围**：项目配置允许的资产清单
- **速率控制**：PPS/QPS限制、时间窗
- **黑白名单**：高敏资产可限制或需审批
- **审计日志**：任务启动、工具执行、外部访问

---

## 七、可观测性与质量控制

- 任务健康：执行耗时、失败率、重试率
- Agent健康：心跳、负载、版本
- 结果质量：误报率、验证通过率
- SLA：核心链路可用性、扫描及时性

---

## 八、技术选型与部署建议

### 8.1 推荐技术栈

- 后端：Python + FastAPI
- 任务编排：Celery + Redis（MVP） / Argo Workflows（规模化）
- 数据：PostgreSQL + Elasticsearch（可选） + MinIO
- 前端：Vue 3 + TypeScript

### 8.2 部署与隔离

- 多租户隔离：逻辑隔离 + 资源配额
- 扫描执行节点独立子网部署
- 统一网关与审计日志

---

## 九、迭代路线图（调整）

### Phase 1（MVP）

- 资产导入、子域名收集、端口扫描、基础漏洞扫描
- 基础任务队列与可视化界面

### Phase 2（可靠性）

- 资产实体ID与去重
- 结果可信度与验证流程
- 扫描治理与速率控制

### Phase 3（可扩展）

- DAG编排 + 事件驱动
- 多租户与权限细化
- 画像与趋势分析

### Phase 4（高级功能）

- API安全测试与深度JS分析
- 威胁情报与自动化处置
- 自适应调度与智能策略

---

## 附：原设计的关键优化点清单（摘录）

- 数据模型补充统一资产ID与关系表
- 扫描结果需加“可信度 + 二次验证”
- 任务编排建议使用DAG替代固定流水
- 引入资产变更状态机与生命周期
- 增加合规控制与授权边界描述
- 增强可观测性与审计能力

